---
# K8s Cluster Maintenance Playbook
# This playbook performs safe maintenance on Kubernetes cluster nodes
# including system updates, node draining, and Datadog monitor management

- name: Kubernetes Cluster Maintenance
  hosts: k8s_cluster
  serial: 1  # Process nodes one at a time for safety
  become: true
  vars:
    # Datadog monitoring settings
    pause_monitors_enabled: true
    pause_duration: 3600  # 1 hour in seconds
    
    # Kubernetes settings
    k8_primary_node: "k8-primary"
    reboot_delay: 30
    reboot_timeout: 600
    node_ready_retries: 30
    node_ready_delay: 10
    
    # Logging settings
    update_log_path: "/var/log/k8s-maintenance.log"
    
  roles:
    - gregheffner.ubuntu_patching.k8_maintenance

  post_tasks:
    - name: Display maintenance completion status
      debug:
        msg: "Maintenance completed for {{ inventory_hostname }} at {{ ansible_date_time.iso8601 }}"